{% extends "base.html" %}
{% block content %}
<style>
    :root {
        --cell-size: 45px;
        --border-thick: 3px solid #333;
        --border-thin: 1px solid #ccc;
        --primary-pink: #ff85a2;
    }

    .game-container { text-align: center; font-family: 'Segoe UI', sans-serif; }

    .sudoku-grid {
        display: grid;
        grid-template-columns: repeat(9, var(--cell-size));
        grid-template-rows: repeat(9, var(--cell-size));
        margin: 20px auto;
        width: max-content;
        border: var(--border-thick);
        background-color: white;
    }

    .cell {
        width: var(--cell-size);
        height: var(--cell-size);
        border: var(--border-thin);
        box-sizing: border-box;
        position: relative;
    }

    /* Thick borders for 3x3 subgrids */
    .cell:nth-child(3n) { border-right: var(--border-thick); }
    .cell:nth-child(9n) { border-right: var(--border-thin); } /* Reset far right edge */
    
    .cell:nth-child(n+19):nth-child(-n+27),
    .cell:nth-child(n+46):nth-child(-n+54) {
        border-bottom: var(--border-thick);
    }

    input.cell-input {
        width: 100%;
        height: 100%;
        border: none;
        text-align: center;
        font-size: 1.3rem;
        background: transparent;
        outline: none;
        color: #333;
    }

    /* Style for pre-filled numbers */
    input.cell-input.fixed {
        background-color: #f0f0f0;
        font-weight: bold;
        color: #000;
        cursor: default;
    }

    input.cell-input:focus { background-color: #fff0f3; }

    .controls { margin-top: 20px; }
    
    button {
        padding: 10px 20px;
        background: var(--primary-pink);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        margin: 5px;
    }

    #status { margin-top: 15px; font-weight: bold; min-height: 24px; }
</style>

<div class="game-container">
    <h2>Valentine Sudoku</h2>
    <p>A little logic for my favorite person. Fill the grid!</p>
    
    <div id="grid" class="sudoku-grid"></div>

    <div class="controls">
        <button onclick="validateSudoku()">Final Submit</button>
    </div>
    <p id="status"></p>
</div>

<form id="next" method="post" action="/complete/6"></form>

<script>
    // A difficult Sudoku pattern
    const solution = [
        6,1,3,2,9,8,4,7,5,
        9,4,8,7,3,5,1,2,6,
        7,5,2,1,4,6,8,9,3,
        8,9,5,3,6,2,7,4,1,
        2,6,1,5,7,4,3,8,9,
        3,7,4,8,1,9,6,5,2,
        1,3,9,4,2,7,5,6,8,
        4,8,6,9,5,3,2,1,7,
        5,2,7,6,8,1,9,3,4
    ];

    // Numbers to keep (null means empty input)
    // 0 = empty, others = fixed
    const startingBoard = [
        0,1,0,2,0,8,0,0,0,
        0,0,0,7,0,0,0,2,6,
        0,0,2,1,4,0,0,9,0,
        0,0,0,0,0,2,7,0,1,
        0,0,0,0,0,0,0,0,0,
        3,0,4,8,0,0,0,0,0,
        0,3,0,0,2,7,5,0,0,
        4,8,0,0,0,3,0,0,0,
        0,0,0,6,0,1,0,3,0
    ];

    function initGrid() {
        const gridEl = document.getElementById('grid');
        for (let i = 0; i < 81; i++) {
            const cellContainer = document.createElement('div');
            cellContainer.className = 'cell';
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'cell-input';
            input.maxLength = 1;
            input.dataset.index = i;

            if (startingBoard[i] !== 0) {
                input.value = startingBoard[i];
                input.readOnly = true;
                input.classList.add('fixed');
            } else {
                input.oninput = (e) => {
                    e.target.value = e.target.value.replace(/[^1-9]/g, '');
                    document.getElementById('status').innerText = ""; // Clear error message on type
                };
            }
            
            cellContainer.appendChild(input);
            gridEl.appendChild(cellContainer);
        }
    }

    function validateSudoku() {
        const inputs = document.querySelectorAll('.cell-input');
        const status = document.getElementById('status');
        let allFilled = true;
        let isCorrect = true;

        inputs.forEach((input, i) => {
            const val = parseInt(input.value);
            if (isNaN(val)) {
                allFilled = false;
            } else if (val !== solution[i]) {
                isCorrect = false;
            }
        });

        if (!allFilled) {
            status.style.color = "orange";
            status.innerText = "The grid isn't finished yet!";
        } else if (!isCorrect) {
            status.style.color = "red";
            status.innerText = "Something isn't quite right... check your rows and columns!";
        } else {
            status.style.color = "green";
            status.innerText = "Perfect! You solved it! ❤️";
            setTimeout(() => document.getElementById("next").submit(), 1500);
        }
    }

    initGrid();
</script>
{% endblock %}
